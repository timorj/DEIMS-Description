<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [软件名称](#%E8%BD%AF%E4%BB%B6%E5%90%8D%E7%A7%B0)
- [版权所有](#%E7%89%88%E6%9D%83%E6%89%80%E6%9C%89)
- [<center>第一章 简介</center>](#center%E7%AC%AC%E4%B8%80%E7%AB%A0-%E7%AE%80%E4%BB%8Bcenter)
  - [1.1 简介](#11-%E7%AE%80%E4%BB%8B)
- [应用效果图](#%E5%BA%94%E7%94%A8%E6%95%88%E6%9E%9C%E5%9B%BE)
- [<center>第二章 安装</center>](#center%E7%AC%AC%E4%BA%8C%E7%AB%A0-%E5%AE%89%E8%A3%85center)
  - [2.1 推荐运行环境介绍](#21-%E6%8E%A8%E8%8D%90%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E4%BB%8B%E7%BB%8D)
  - [2.2 Windows下安装DEIMS](#22-windows%E4%B8%8B%E5%AE%89%E8%A3%85deims)
    - [2.2.1 安装DEIMS](#221-%E5%AE%89%E8%A3%85deims)
- [<center>第三章 软件入门</center>](#center%E7%AC%AC%E4%B8%89%E7%AB%A0-%E8%BD%AF%E4%BB%B6%E5%85%A5%E9%97%A8center)
  - [3.1 DEIMS初探](#31-deims%E5%88%9D%E6%8E%A2)
  - [3.2 DEIMS基本操作](#32-deims%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C)
    - [3.2.1 旋转](#321-%E6%97%8B%E8%BD%AC)
    - [3.2.2 缩放](#322-%E7%BC%A9%E6%94%BE)
    - [3.2.3 欧拉角变换](#323-%E6%AC%A7%E6%8B%89%E8%A7%92%E5%8F%98%E6%8D%A2)
    - [3.2.4 鼠标空间位置显示](#324-%E9%BC%A0%E6%A0%87%E7%A9%BA%E9%97%B4%E4%BD%8D%E7%BD%AE%E6%98%BE%E7%A4%BA)
    - [3.2.5 视点动画](#325-%E8%A7%86%E7%82%B9%E5%8A%A8%E7%94%BB)
  - [3.3 球坐标系和直角坐标系切换](#33-%E7%90%83%E5%9D%90%E6%A0%87%E7%B3%BB%E5%92%8C%E7%9B%B4%E8%A7%92%E5%9D%90%E6%A0%87%E7%B3%BB%E5%88%87%E6%8D%A2)
  - [3.4 图形对象属性修改](#34-%E5%9B%BE%E5%BD%A2%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7%E4%BF%AE%E6%94%B9)
- [<center>第四章 基础地质调查信息管理</center>](#center%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E5%9F%BA%E7%A1%80%E5%9C%B0%E8%B4%A8%E8%B0%83%E6%9F%A5%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86center)
  - [4.1 数据入库](#41-%E6%95%B0%E6%8D%AE%E5%85%A5%E5%BA%93)
    - [4.1.1 影像数据入库](#411-%E5%BD%B1%E5%83%8F%E6%95%B0%E6%8D%AE%E5%85%A5%E5%BA%93)
    - [4.1.2 地质贴图数据入库](#412-%E5%9C%B0%E8%B4%A8%E8%B4%B4%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%85%A5%E5%BA%93)
    - [4.1.3 地质调查数据入库](#413-%E5%9C%B0%E8%B4%A8%E8%B0%83%E6%9F%A5%E6%95%B0%E6%8D%AE%E5%85%A5%E5%BA%93)
  - [4.2 数据载入](#42-%E6%95%B0%E6%8D%AE%E8%BD%BD%E5%85%A5)
  - [4.3 青藏科考地质调查信息管理](#43-%E9%9D%92%E8%97%8F%E7%A7%91%E8%80%83%E5%9C%B0%E8%B4%A8%E8%B0%83%E6%9F%A5%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86)
    - [4.3.1地质点数据管理](#431%E5%9C%B0%E8%B4%A8%E7%82%B9%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86)
    - [4.3.2 地质图层叠加](#432-%E5%9C%B0%E8%B4%A8%E5%9B%BE%E5%B1%82%E5%8F%A0%E5%8A%A0)
    - [4.3.3 数据查询接口](#433-%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E6%8E%A5%E5%8F%A3)
- [<center>第五章 地质元数据信息管理</center>](#center%E7%AC%AC%E4%BA%94%E7%AB%A0-%E5%9C%B0%E8%B4%A8%E5%85%83%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF%E7%AE%A1%E7%90%86center)
  - [5.1 地质元数据库说明](#51-%E5%9C%B0%E8%B4%A8%E5%85%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%B4%E6%98%8E)
    - [5.2.1 添加地质点数据](#521-%E6%B7%BB%E5%8A%A0%E5%9C%B0%E8%B4%A8%E7%82%B9%E6%95%B0%E6%8D%AE)
    - [5.2.2 添加地质图数据](#522-%E6%B7%BB%E5%8A%A0%E5%9C%B0%E8%B4%A8%E5%9B%BE%E6%95%B0%E6%8D%AE)
    - [5.2.3 添加体素数据](#523-%E6%B7%BB%E5%8A%A0%E4%BD%93%E7%B4%A0%E6%95%B0%E6%8D%AE)
  - [5.3 数据信息修改](#53-%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF%E4%BF%AE%E6%94%B9)
  - [5.3 数据信息删除](#53-%E6%95%B0%E6%8D%AE%E4%BF%A1%E6%81%AF%E5%88%A0%E9%99%A4)
    - [5.3.1 单一记录项删除](#531-%E5%8D%95%E4%B8%80%E8%AE%B0%E5%BD%95%E9%A1%B9%E5%88%A0%E9%99%A4)
    - [5.3.2 多个记录项删除](#532-%E5%A4%9A%E4%B8%AA%E8%AE%B0%E5%BD%95%E9%A1%B9%E5%88%A0%E9%99%A4)
    - [5.3.3 全部记录项删除](#533-%E5%85%A8%E9%83%A8%E8%AE%B0%E5%BD%95%E9%A1%B9%E5%88%A0%E9%99%A4)
  - [5.4 数据筛选查询](#54-%E6%95%B0%E6%8D%AE%E7%AD%9B%E9%80%89%E6%9F%A5%E8%AF%A2)
  - [5.5 地质元数据管理](#55-%E5%9C%B0%E8%B4%A8%E5%85%83%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86)
    - [5.5.1 地质点数据管理](#551-%E5%9C%B0%E8%B4%A8%E7%82%B9%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86)
    - [5.5.2 地质图数据管理](#552-%E5%9C%B0%E8%B4%A8%E5%9B%BE%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86)
    - [5.5.3 地质体素数据管理](#553-%E5%9C%B0%E8%B4%A8%E4%BD%93%E7%B4%A0%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86)
  - [5.6 元数据属性修改](#56-%E5%85%83%E6%95%B0%E6%8D%AE%E5%B1%9E%E6%80%A7%E4%BF%AE%E6%94%B9)
- [<center> 第五章 高级设置</center>](#center-%E7%AC%AC%E4%BA%94%E7%AB%A0-%E9%AB%98%E7%BA%A7%E8%AE%BE%E7%BD%AEcenter)
  - [5.1 添加网络瓦片源](#51-%E6%B7%BB%E5%8A%A0%E7%BD%91%E7%BB%9C%E7%93%A6%E7%89%87%E6%BA%90)
  - [5.2 切换初始网络瓦片源](#52-%E5%88%87%E6%8D%A2%E5%88%9D%E5%A7%8B%E7%BD%91%E7%BB%9C%E7%93%A6%E7%89%87%E6%BA%90)
  - [5.3 添加自定义瓦片源初始化](#53-%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%93%A6%E7%89%87%E6%BA%90%E5%88%9D%E5%A7%8B%E5%8C%96)
  - [5.4 地形开关](#54-%E5%9C%B0%E5%BD%A2%E5%BC%80%E5%85%B3)
  - [5.5 地形瓦片源选择](#55-%E5%9C%B0%E5%BD%A2%E7%93%A6%E7%89%87%E6%BA%90%E9%80%89%E6%8B%A9)
  - [5.6 软件缓存文件夹修改](#56-%E8%BD%AF%E4%BB%B6%E7%BC%93%E5%AD%98%E6%96%87%E4%BB%B6%E5%A4%B9%E4%BF%AE%E6%94%B9)
- [<center>第六章 软件的开发难点</center>](#center%E7%AC%AC%E5%85%AD%E7%AB%A0-%E8%BD%AF%E4%BB%B6%E7%9A%84%E5%BC%80%E5%8F%91%E9%9A%BE%E7%82%B9center)
  - [6.1 渲染技术开发](#61-%E6%B8%B2%E6%9F%93%E6%8A%80%E6%9C%AF%E5%BC%80%E5%8F%91)
  - [6.2 多源异构数据的整合](#62-%E5%A4%9A%E6%BA%90%E5%BC%82%E6%9E%84%E6%95%B0%E6%8D%AE%E7%9A%84%E6%95%B4%E5%90%88)
  - [6.3 大规模影像数据渲染](#63-%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%BD%B1%E5%83%8F%E6%95%B0%E6%8D%AE%E6%B8%B2%E6%9F%93)
- [<ceter> 第七章 软件应用前景</center>](#ceter-%E7%AC%AC%E4%B8%83%E7%AB%A0-%E8%BD%AF%E4%BB%B6%E5%BA%94%E7%94%A8%E5%89%8D%E6%99%AFcenter)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# 软件名称
西藏班公怒江数字地球信息管理系统(Tibet Bangong Nujiang Digital Earth Information Management System)
>软件简称:DEIMS
# 版权所有
- Chengdu University of Technology;
- Institute of Geology and Geophysics, Chinese Academy of Sciences.
# <center>第一章 简介</center>
## 1.1 简介
&emsp; &emsp; **数字班公怒江地质信息管理系统**以班-怒带铬铁矿与铂族元素成矿潜力子专题任务为依托，开发的一款可视化管理地质调查数据的客户段支持软件。软件实现了将原始的野外地质调查数据整合处理后，根据数据真实的空间信息，将地质工作者的原始采集数据进行快速可视化分析，结合三维数字地球再现野外工作场景，给野外地质工作带来巨大的工作效率提升。软件主要具备以下几点优势：
- 异构数据源整合
>软件支持各种原始野外的地质调查数据的可视化分析，通过OpenXML技术可以快速处理野外地质调查时产生的.doc、.docx、.xls和.xlsx数据源类型，支持海量数据处理，轻松整合所有相关业务数据，帮助地质工作者消灭数据孤岛。
- 数据三维可视化分析
>软件将野外地质工作中最为常见和重要的空间信息利用起来，让枯燥单一的数据以简单直观的形式呈现出来，节省大量的数据处理环节从而极大的提高了操作效率，打通了所有技术难题从而降低了数据分析的难度，让地质工作者更加专注于数据本身，更好的帮助地质工作者从原始地质调查数据中得到更加有用的信息，使得有更多的时间花在以数据为驱动的任务上，从而节省地质工作者宝贵的时间。
- 先进的底层渲染技术
>三维图形可视化交互性能取决于底层的渲染驱动技术，三维数字地球由于有大规模渲染大量的卫星影像数据需求，所以软件采用的是最新一代图形驱动技术Vulkan，同时还拥有自主产权的Vulkan驱动库。Vulkan是一个跨平台的2D和3D绘图应用程序接口，最早由科纳斯组织在2015年的游戏开发者大会上发布，以更低的开销渲染出更好的图形效果，是下一代的图形渲染技术。拥有更快的性能、更低的开销、更少的延迟，可移植和可扩展的渲染优势，能够更好的适应软件的渲染需求。
- 高效的大规模渲染
>真实的三维数字地球表面覆盖着的是卫星遥感影像，而现实的地球调查工区集中在很小的一个区块，这时候为了确保数据管理的有效性就需要加载高层级的卫星遥感影像。但是高层级的卫星遥感影像也意味着庞大的数据量，软件通过四叉树和定尺寸分割技术有效的解决了大规模遥感影像的渲染问题。
- 软件操作简单易上手
>软件针对三维图形交互做了专门的优化，对象的旋转、缩放和平移操作符合人体直觉，无需额外的学习成本就能轻松快速的使用软件。

# 应用效果图
![](./%E5%9B%BE%E7%89%87/动图/image29.gif)
![](./%E5%9B%BE%E7%89%87/%E5%8A%A8%E5%9B%BE/image30.gif)
![](./%E5%9B%BE%E7%89%87/%E5%8A%A8%E5%9B%BE/image39.gif)
![](./%E5%9B%BE%E7%89%87/%E5%8A%A8%E5%9B%BE/image54.gif)
![](./%E5%9B%BE%E7%89%87/%E5%8A%A8%E5%9B%BE/%E5%9B%BE%E7%89%871.gif)
![](./%E5%9B%BE%E7%89%87/%E5%8A%A8%E5%9B%BE/%E5%9B%BE%E7%89%872.gif)
# <center>第二章 安装</center>
## 2.1 推荐运行环境介绍
&emsp; &emsp; **数字班公怒江地质信息管理系统**运行于任何装有Windows操作系统的品牌机或兼容机上。为了获得更好的运行体验，推荐配置如下：
<br>计算机硬件：</br>
***
CPU：Intel Core I5 7300HQ;
内存：8GB;
硬盘：50GB;
显卡：NVIDIA GTX1050Ti.
***
<br>计算机软件：</br>
***
采用C#进行编译并生成相应执行文件格式，在Windows10/XP上运行。显卡支持支持OpenGL 3.5 / Direct 3D / Vulkan，且Windows系统装有.Net Framework 4.6以上框架。
***
## 2.2 Windows下安装DEIMS
DEIMS为Windows用户提供了64位的安装包，可以直接安装使用。
>警告：
<br>安装前请检查你的Windows登录用户名：(1)是否包含空格；(2)是否包含中文。以上两种情况都可能导致DEIMS运行出错。如果用户名不符合要求与。请新建一个用户。然后使用新用户登录Windows，再安装DEIMS。
### 2.2.1 安装DEIMS
1. 联系[本公司](http://cdtracer.cn/)获取对应的DEIMS安装包，DEIMS所有功能仅包含在一个安装包中：
<br>
![安装包](./图片/2022-09-21%2014.47.57.png)</br>
2. 安装DEIMS
   
&emsp;&emsp;&emsp;双击安装包即可安装。 安装过程可以根据您自己的需求渲染对应的安装配置。
***
**备注**：安装过程可能需要获取管理员权限，由于安装的路径可能选择在C盘，所以选择"是"即可。
***
3. 测试安装
   
   安装完成后，点击``开始``$\rightarrow$``所有程序``，如果能在所有程序中找到**西藏班公湖怒江数字地球信息管理系统**程序图标，则说明DEIMS安装成功。
   ![安装成功](./%E5%9B%BE%E7%89%87/2022-09-21%2015.01.03.png)
4. 升级DEIMS

    DEIMS目前不具备自动更新功能，如果想要升级新版本，通常需要先卸载旧版本。卸载完成后，再联系[本公司](http://cdtracer.cn/)获取新版安装包以完成升级。
5. 卸载DEIMS
   
   若想要卸载DEIMS，可以进入系统的``设置``->``应用``，或者``控制面板``->``卸载程序``进行卸载。偶尔会遇到卸载不干净的情况，可以等卸载程序执行完成后再手动删除DEIMS安装目录即可。
# <center>第三章 软件入门</center>
这一章通过一系列简单的示例介绍如何使用DEIMS的基本配置和使用功能，第一次使用应仔细阅读掌握DEIMS的基本用法。
## 3.1 DEIMS初探
这一节将介绍如何开始使用DEIMS。

**启动软件**

DEIMS是一个客户端应用程序，程序安装完毕后可以通过``开始``->``所有程序``，在所有程序中找到安装完毕的DEIMS程序。

**运行DEIMS**

双击图标可以启动DEIMS的客户端，稍等片刻即可看到DEIMS的主要界面，类似于：
![主界面](./%E5%9B%BE%E7%89%87/2022-09-21%2015.45.24.png)

DEIMS的主界面主要分别四个功能区，软件顶部是菜单栏，左侧的Objects窗口是对象窗口，右侧最大部分的Rendering窗口是渲染窗口，软件底部的Messages窗口的消息窗口。
>**备注**：
>- 菜单栏主要包含软件所拥有的全部功能，后面会一一介绍；
>- 对象窗口主要显示右侧渲染窗口中所有的渲染对象相关信息和属性;
>- 渲染窗口软件最重要的窗口，负责所有对象渲染的功能;
>- 消息窗口主要负责显示渲染过程的相关日志。 

**初始化数字地球**

点击菜单栏的``Coordinate``->``Earth``即可初始化数字地球，类似于：

![初始化数字地球](./%E5%9B%BE%E7%89%87/2022-09-21%2016.00.20.png)

由于数字地球所有瓦片数据需要从服务器缓存，为了提高效率，首次初始化数字地球时，需要您指定本地缓存文件夹。如图所示：

![选择缓存文件夹](./%E5%9B%BE%E7%89%87//2022-09-21%2016.07.41.png)

选择完文件夹后，点击``确认``即可。软件强制需要您选择本地缓存文件夹，如果没有选择则会退出本软件，选择完毕后就可以进入数字地球界面了。

## 3.2 DEIMS基本操作
软件支持大多数数字地球同样的基本操作，如旋转、缩放等，在三维图形交互体验的优化符合人的直觉。

### 3.2.1 旋转

软件支持三种不同的方式旋转地球：(1)鼠标移动；(2)键盘操作；(3)按钮点击。

*鼠标移动*

三维数字地球的本体支持通过鼠标配合支持旋转操作，旋转操作逻辑如下：鼠标左键按下不放往任意方向移动，地球就往指定的方向旋转。

*键盘操作*

除了利用鼠标操作地球旋转，软件还支持软件操作地球。其中``WASD``键分别对应将按照不同的方向进行旋转。
>``W``键对应沿X轴顺时针旋转30度、``S``键对应沿X轴逆时针旋转30度；
><br>``D``键对应沿Y轴顺时针旋转30度、``A``键对应沿Y轴旋转30度。

*按钮点击*

按旋转窗口有一排对应的功能按钮，可以实现对地球的旋转操作。如图所示。

![X旋转](./%E5%9B%BE%E7%89%87/2022-09-21%2019.49.55.png)
![Y旋转](./%E5%9B%BE%E7%89%87/2022-09-21%2019.50.45.png)
![Z旋转](./%E5%9B%BE%E7%89%87/2022-09-21%2019.51.41.png)

旋转完毕后需要还原数字地球的初始状态，可以使用键盘的``R``键。还可以利用功能按钮中对应的按钮还原地球初始状态，如图：

![重置视图](./%E5%9B%BE%E7%89%87/2022-09-21%2019.55.07.png)

### 3.2.2 缩放
数字地球最重要的就是在多尺度的状态下观测物体，所以软件也支持使用鼠标滚轮滑动实现视点高度远近的变换。
>鼠标滚轮顺时针旋转对应视点靠近地球，反之则是远离地球。

![大尺度](./%E5%9B%BE%E7%89%87/2022-09-21%2019.59.48.png)
![小尺度](./%E5%9B%BE%E7%89%87/2022-09-21%2020.00.37.png)

### 3.2.3 欧拉角变换

欧拉角是用来确定定点转动刚体位置的3个一组独立角参量，由偏航角α、旋进角（即滚筒角）β和俯仰角γ组成，为欧拉首先提出而得名。

![欧拉角](./%E5%9B%BE%E7%89%87/2022-09-21%2020.07.53.png)

软件支持两个自由度的欧拉角的变换:(1)绕X轴旋转的滚筒角;(2)俯仰角。

*滚筒角*

类似于旋转的鼠标操作，滚筒角的变换的操作逻辑同样是利用鼠标来实现，鼠标右键按下不放往左移动，地球的滚筒角就往顺时针旋转；鼠标右键按下不放往右移动，地球的滚筒角就往逆时针移动。

*俯仰角*

俯仰角的变换同样是通过鼠标滑动来实现:鼠标右键按下不放往上移动，地球的俯仰角就减小(类似于人眼往下看);游标右键按下不放往下移动，地球的俯仰角就增加(类似于人眼往上看)。

### 3.2.4 鼠标空间位置显示

软件支持实时显示鼠标所在空间位置的显示。鼠标在地球上滑动时，渲染窗口下的状态栏就会实时更新鼠标的空间位置。类似于：

![鼠标空间位置](./%E5%9B%BE%E7%89%87/2022-09-21%2020.23.40.png)

>注：鼠标的高程值是根据当前层级的高程瓦片数据精度计算所得，可能与真实的高程有一定的误差。当视点越靠近地球时，高程瓦片的数据精度就越高，鼠标位置所在的高程值就会越精确。

### 3.2.5 视点动画

软件支持自定义视点动画，指定初始视点位置和目标视点位置，可以实现从视点位置到目标位置的动画模拟。动画配置按钮在渲染窗口的功能按钮中，点击``定位``按钮：

![定位](./%E5%9B%BE%E7%89%87/2022-09-21%2020.33.24.png)

出现动画配置窗口：

![动画配置窗口](./%E5%9B%BE%E7%89%87/2022-09-21%2020.34.57.png)

通过改变右侧目标视点状态栏中对应的状态数据，再点击``确定``按钮，即可进行视点动画。

## 3.3 球坐标系和直角坐标系切换

软件支持球坐标系统和直接坐标系统的显示模式。在球坐标系下，采用的是双精度浮点数经纬度坐标系统。以度为单位，经度范围0至360度，维度范围0-180度，高程单位为米。

显示选择菜单``Coordinate`` => ``Earth``,就会在渲染窗口渲染出三维数字地球，并且也会在左侧渲染对象窗口同步更新已渲染对象的信息。点选三维数字地球后，``Earth``按钮也会加深颜色，表示已经渲染地球数据。再次点击，按钮复原，并且渲染窗口取消渲染地球。如图：

![球坐标](./%E5%9B%BE%E7%89%87/image27.png)
![直角坐标](./%E5%9B%BE%E7%89%87/image28.png)

## 3.4 图形对象属性修改

同时添加到窗口中的图形对象，软件支持对其状态属性进行修改。以渲染好的地球对象为例，在渲染对象导航栏点击该对象，在属性窗口展示该对象的属性。在属性窗口中对属性进行修改，可实现对象显示的调整。

![对象属性](./%E5%9B%BE%E7%89%87/image31.png)

主要的属性参数如下：

- 旋转参数：Angle X, AngleY,Angle Z，分别代表图形对象绕X轴，Y轴和Z轴的旋转角度（以度为单位）；
- 缩放比例参数：Scale X,Scale Y,Scale Z，分别代表对象在三个坐标轴方向上的缩放比例，默认为1；
- 平移参数：Translation X, Translation Y, Translation Z，分别代表图形在三个方向上的平移距离；
- Visible：显示开（True）/关（False）
- Blend：透明显示开(True)/ 关（False）
- Blend Alpha：透明度（0-1），0全透明，1不透明；
- Enable Texture：启用贴图(True)/不启用（False）
- Texture Image:贴图图片文件名（全路径）
  
如果图形需要在球坐标系下显示，则需要设置如下属性值：

- Longitue1，Longitue2：经度范围，双精度小数，以度为单位，0-360；
- Latitude1，Latitude2：维度范围，双精度小数，以度为单位，0-180；
- Elevation1，Elevation2：高程范围，双精度小数，以米为单位，以地球平均半径为参考。
# <center>第四章 基础地质调查信息管理</center>
这一章主要介绍软件基于拉昂错路线调查数据实现的信息管理方案。
## 4.1 数据入库
软件支持多种数据源格式，包括但不限于.doc、.docx、.xls、.xlsx、png等，通过载入的数据可以将其存放到数据库中，使用的数据库为:Sqlite。通过数据库统一管理和加载数据，方便快捷，可以满足地质贴图数据、影像数据和地质点数据的管理需求。

选取菜单``Coordinate`` => ``Load Data``，然后就会弹出一个数据入库文件对话框，软件支持多达三中不同类型的源数据渲染，分别为影像数据、地质贴图和地质调查数据。如下图:

![数据入库](./%E5%9B%BE%E7%89%87/image1.png)

### 4.1.1 影像数据入库

影像数据泛指需要在数字地球上进行渲染管理的本地栅格影像数据，数据的一般格式为.tif。通常某些工区的网络瓦片精度无法满足工区的需要或者需要加载自定义的栅格影像数据，软件支持加载这些自定义的影像数据。注意栅格数据的投影须为横轴墨卡托投影（EPSG:900913），其WTK格式为：
```
PROJCS["Google Maps Global Mercator",
        GEOGCS["WGS 84",
            DATUM["WGS_1984",
                SPHEROID["WGS 84", 6378137, 298.2572235630016,
                    AUTHORITY["EPSG", "7030"]],
                AUTHORITY["EPSG", "6326"]],
            PRIMEM["Greenwich", 0],
            UNIT["degree", 0.0174532925199433],
            AUTHORITY["EPSG", "4326"]],
             PROJECTION["Mercator_1SP"],
             PARAMETER["central_meridian", 0],
             PARAMETER["scale_factor", 1],
             PARAMETER["false_easting", 0],
             PARAMETER["false_northing", 0],
             UNIT["metre", 1,
                 AUTHORITY["EPSG", "9001"]]]
```
软件具有三个文件选择对话框，分别对应``影像数据``、``地质贴图``和``地质调查数据``。默认的对话框为``影像数据``，点击``选择文件``按钮，将会弹出文件选择对话框。对话框将会提示选择影像数据文件，单击目标文件，再选择``打开``会将数据加载进内存等待进一步处理。如下图:

![影像数据文件选择](./%E5%9B%BE%E7%89%87/image2.png)
![数据准备](./%E5%9B%BE%E7%89%87/image3.png)

**影像预处理**
>由于高精度的栅格数据一般具有庞大的数据量，一次性加载将会花费大量的加载及渲染事件。为了优化渲染效率，软件采用定尺寸裁剪和四叉数据裁剪两个优化策略，使得加载和渲染事件大幅度的缩短，提高了软件的性能。

*定尺寸裁剪*

对于单个栅格数据软件默认的裁剪方式为定尺寸裁剪，加载栅格影像裁剪为单个为1000x1000尺寸的瓦片数据，再将其存放进数据库中。点击``裁剪``按钮，软件会弹出文件夹选择对话框，提示选择裁剪后的瓦片的输出文件夹。选择后将会执行裁剪逻辑，对话框左下角则会显示``正在裁剪，请等待…``的提示，裁剪完毕后将会弹出瓦片输出文件夹，提示裁剪结果，同时在DataGridView中将会显示存放数据库中相关信息。如下图：

![文件选择](./%E5%9B%BE%E7%89%87/image4.png)

![裁剪](./%E5%9B%BE%E7%89%87/image5.png)

![裁剪完](./%E5%9B%BE%E7%89%87/image6.png)

![裁剪完](./%E5%9B%BE%E7%89%87/image7.png)

栅格影像数据的相关信息将会显示在DataGridView中，在进行最后一步入库之前，栅格影像数据的信息支持修改。双击需要进行修改的数据列，就可以对相应数据进行修改，失去对数据列的焦点后，就会显示数据更改成功的对话框。再点击``确定入库``按钮就可以将数据存法进数据库中。如下图:

![数据修改](./%E5%9B%BE%E7%89%87/image8.png)

为了进一步提升效率，软件还支持对一个文件夹下的所有栅格影像数据进行统一入库。点击``选择文件夹``，就会弹出文件夹选择对话框，提示选择目标文件夹，单击目标文件夹，再选择``打开``会将数据加载进内存等待进一步处理。如下图：

![文件夹选择](./%E5%9B%BE%E7%89%87/image9.png)
![数据修改](./%E5%9B%BE%E7%89%87/image10.png)

对于文件夹中的所有数据软件支持两种不同的数据裁剪方式：定尺寸裁剪和四叉树裁剪。其中定尺寸裁剪支持修改裁剪的大小。默认的裁剪方式为指定大小裁剪。如下图：

![数据修改](./%E5%9B%BE%E7%89%87/image11.png)

选择裁剪方式后，再点击``裁剪``，跟单个文件裁剪类似，将会提示选择输出文件夹，再将裁剪结果输出到DataGridView中。如下图：

![裁剪后](./%E5%9B%BE%E7%89%87/image12.png)
![裁剪后](./%E5%9B%BE%E7%89%87/image13.png)

同样每一行的栅格数据信息都支持修改，再点击``确定入库``就可以将所有的数据都存放到数据库中。

### 4.1.2 地质贴图数据入库

跟影像数据的需求类似，某些工区可能需要加载自定义的地质贴图，如地质填图，地质剖面等。但有一点不同的是，栅格影像数据自带有投影信息，而地质贴图无法从原始数据中获取其投影信息，需要手动输入。

对于地质贴图数据入库，软件同样支持单个文件和统一文件夹输入。点击``地质贴图``对话框，再点击``选择文件``按钮，即可进行文件选择。

![文件选择](./%E5%9B%BE%E7%89%87/image14.png)
![文件选择](./%E5%9B%BE%E7%89%87/image15.png)

剩余操作与4.1.1节的栅格影像数据的操作一致，唯一的不同就是裁剪后地质贴图的投影信息需要手动输入。如下图：

![数据信息](./%E5%9B%BE%E7%89%87/image16.png)

修改后点击``确定入库``按钮就可以将相应的地质贴图存放到数据库中。如下图：

![数据入库](./%E5%9B%BE%E7%89%87/image17.png)

### 4.1.3 地质调查数据入库

由于地质调查数据具有多源异构的特性，原始的地质调查数据可能许多不同格式的数据。就本项目的地质调查数据而言，软件的数据的格式为.docx。数据的结构形式如下图:

![原始数据信息](./%E5%9B%BE%E7%89%87/image18.png)

根据原始数据的数据特点，软件通过OpenXML技术实现了从原始数据到数据库的一键式生成。其意义通常一手的地质调查数据自身都十分冗长，再通过机械重复的输入极大的消耗了地质工作者原本就十分保存的时间。通过本软件只需按照相应格式编写原始数据文档，就可以实现一步导入数据库，极大的提升了地质工作者的工作效率。

点击``地质调查数据``对话框，再点击``选择文件``按钮，就可以进行文件选择。如下图:

![文件选择](./%E5%9B%BE%E7%89%87/image19.png)

再点击``确定入库``按钮，就可以将原始地质数据一键导入到数据库中，同样导入数据库的地质调查数据相关信息支持修改并将修改同步到数据库中。如下图:

![文件选择](./%E5%9B%BE%E7%89%87/image20.png)

## 4.2 数据载入

软件实际载入并能进行管理的数据，是由之前导入的原始数据经过算法处理后，并规范化整理到数据库中的标准数据。数据存放到数据库后的部分表的结构如下图所示：

![数据表](./%E5%9B%BE%E7%89%87/image21.png)

由于地质调查数据主要以三维数字地球为依托，所以在加载地质调查数据之前，需要先加载三维数字地球数据。

选择菜单``Coordinate`` => ``GeoResearch Data``，就会弹出加载信息的窗口。如图：

![加载信息](./%E5%9B%BE%E7%89%87/image22.png)

点击下拉列表会弹出要在需要显示的数据库列表。目前软件支持三种不同数据源的数据库：地质调查数据库、贴图数据库和地质元数据库。软件未来支持多套数据库信息的显示，对于数据显示的改变只需要选择不同的数据库，使得数据显示更加的通用，关于地质元数据的相关信息将在后面的章节进行介绍。如下图：

![数据库选择](./%E5%9B%BE%E7%89%87/image23.png)

选择要显示的数据库，就会在窗口的空白处，对数据库的信息进行预览。以``第二次青藏高原综合科学考察研究``数据库为例，如图：

![选择数据库](./%E5%9B%BE%E7%89%87/image24.png)

以数据表的一行为一个地质信息，软件支持同时渲染一个或者多个地质调查信息。通过按住``Shift``键就是自定义选择要显示的地质调查信息，按住``Ctrl``键还支持反选。如果要加载全部地质信息，可以通过点击左下角的``全选``按钮全选所有数据。再点击加载就能在渲染窗口显示出选择的地质调查数据。同时在左边的窗口也会加载出地质调查数据的导航栏。如图：

![选择数据库](./%E5%9B%BE%E7%89%87/image25.png)

同时在对象窗口也会同步加载地质点号对象，从而支持对地质点号渲染对象的单独修改。如图：

![选择数据库](./%E5%9B%BE%E7%89%87/image26.png)

## 4.3 青藏科考地质调查信息管理

根据不同的地质目的和地质需求，系统设计了不同的地质数据数据库，通过加载不同的数据库的方式来实现对不同地质数据的管理要求。

以青藏科考地质调查数据为例，设计了青藏科考地质调查数据库数据。通过对地质调查数据的分析，采用层次结构，将地质数据分为2个层级。第一层为路线信息，第二层为地质点信息。路线信息包含了地质点信息。在窗口导航栏中以树形菜单列表进行显示。地质调查数据导航栏展示了数据的包含关系：路线下所含的是从数据库中加载的信息中的所有路线，每个路线下又含有许多信息，示例中只含有地质点号信息，在地质点号下，就包含又该路线中所加载的所有的地质点号。如图：

![地质点数据](./%E5%9B%BE%E7%89%87/image40.png)

通过右击导航栏的树节点，会弹出右键菜单。右键菜单有三个选项：``添加数据``、``移除数据``和``查看详细信息``。如图：

![右键菜单](./%E5%9B%BE%E7%89%87/image41.png)

### 4.3.1地质点数据管理

点击右键菜单的``添加数据``，就会跳转到添加数据的界面，以便继续添加要显示的数据。如下图：

![添加数据](./%E5%9B%BE%E7%89%87/image42.png)

点击``移除数据``，就会将数据从导航栏中移除，同时也会在渲染窗口取消渲染该对象。对于渲染对象的可见性设置，除了直接移除该对象外，软件还支持通过导航栏中，每个节点的复选框来进行设置。数据在初始加载后，没有节点的复选框都是选中的状态，在渲染窗口所有对象也会进行渲染。点击路线的复选框，该路线下的所有的对象就会取消渲染；点击某个地质点号的复选框，就会取消渲染这一个地质对象。如图：
![移除数据1](./%E5%9B%BE%E7%89%87/image43.png)
![移除数据2](./%E5%9B%BE%E7%89%87/image44.png)

点击右键菜单的``查看详细信息``，就会在右侧加载一个详细信息窗口，来展示选中数据的详细信息。对于不同的树节点，就会显示不同的详细信息。

对于路线的详细信息，主要显示三个大类的信息：路线概况、路线数据信息详情、已加载的地质点号详情。路线概况包含的信息有：路线名称、路线任务、记录者、调查时间、同行者。路线概况信息主要是根据原始的地质调查数据信息。路线数据信息详情包含的信息有：已加载的地质点号总数，总地质点号数、经纬度范围。路线数据信息详情主要是对已经加载完的数据的相关信息的总体预览。已加载的地质点号详情，则是预览所有在导航栏加载的数据详情。如图：

![详细信息](./%E5%9B%BE%E7%89%87/image45.png)   

对于地质点号的详细信息，主要显示的四个大类的信息：地质点号概况、点间路线概况、点上样品概况和点上照片概况。由于数据文件的特殊性，并不是每一个地质点号都有上述的四个信息，软件会自动根据数据库中信息展示正确的信息出来。如图：

![详细信息](./%E5%9B%BE%E7%89%87/image46.png)
![详细信息](./%E5%9B%BE%E7%89%87/image47.png)
![详细信息](./%E5%9B%BE%E7%89%87/image48.png)
![详细信息](./%E5%9B%BE%E7%89%87/image49.png)

为了使得软件的操作更符合人体直觉，对于地质对象的选中操作，软件做了专门的优化。通过射线检测算法，实现对屏幕坐标拾取再转换为真实的世界空间坐标，再与地质对象的球状包围盒做相交检测，就能实现对地质对象的点击选取操作。软件实现了在渲染窗口点击地质对象，就显示该地质对象的详细信息并高亮显示对象，再通过双击鼠标右击进行取消选中。主要到所有的地质对象都具有真实的高程数据。由于瓦片数据的渲染不仅从网络瓦片数据请求，还有真实的地形数据。同时每个地质对象的点间连线都紧贴地形绘制。如图:

![详细信息](./%E5%9B%BE%E7%89%87/image50.png)

### 4.3.2 地质图层叠加

在现有卫星遥感影响图的基础上，软件还支持地质影像图的叠加功能，将区域地质图叠加到地球表面上，和卫星地图进行融合显示。实现步骤如下:

（1）准备区域地质图（tiff、png、Jpg等格式），由于图片一般是矩形结构，区域范围比较大的地质图需要经过球面坐标校正，即把球面坐标下的地质图校正到直角坐标系统下，使得经纬线成为相互正交的直线。

（2）球坐标校正。

-	从``Tool``菜单选取``Convert``->``toEarthTexture``，在校正窗口中``Load``菜单载入待校正图像；
-	从``Draw``菜单中选择曲线绘制工具，沿球面上下维线对图像边界进行边界描点；
-	从工具栏中选取``Location``按钮，用鼠标点击在图像边缘的4个位置进行经纬度范围定位；
-	选取``Revise``菜单，选取球面修正``Earth Revise``，完成后将校正后的图片另存。

![坐标校正](./%E5%9B%BE%E7%89%87/image51.png)
![校正后](./%E5%9B%BE%E7%89%87/image52.png)

（3）将校正后的图片存入前文提到的地质贴图数据库即可，通过选择``地质贴图``数据库可加载网格曲面地质贴图。

![地质图叠加](./%E5%9B%BE%E7%89%87/image53.png)
![地质图叠加](./%E5%9B%BE%E7%89%87/image54.gif)
![地质图叠加](./%E5%9B%BE%E7%89%87/image55.png)
![地质图叠加](./%E5%9B%BE%E7%89%87/image56.png)
![地质图叠加](./%E5%9B%BE%E7%89%87/image57.png)
![地质图叠加](./%E5%9B%BE%E7%89%87/image58.png)
![地质图叠加](./%E5%9B%BE%E7%89%87/image59.png)

### 4.3.3 数据查询接口

软件支持对已经加载好的数据进行查询管理，同时对于查询到的数据支持在三维图形渲染窗口高亮显示。进一步强化了对地质调查数据的管理。在三维图形渲染对象导航栏窗口右键打开``右键菜单``，如图：

![右键菜单](./%E5%9B%BE%E7%89%87/image60.png)

点击``搜索数据``按钮，就会弹出搜索数据窗口，如图：

![搜索数据](./%E5%9B%BE%E7%89%87/image61.png)

在下拉框选择要查询的属性，并在输入框输入要查询的属性数据。软件支持多种不同的属性查询，如图：

![搜索数据](./%E5%9B%BE%E7%89%87/image62.png)

再点击``搜索``按钮就会在渲染的数据中，查询出对应属性的数据并在DataGridView中，显示出查询到的数据详细信息。如图：

![搜索数据](./%E5%9B%BE%E7%89%87/image63.png)

最后就能根据自己的需求，在三维图形渲染窗口高亮显示对应的三维实体数据。如图：

![搜索数据](./%E5%9B%BE%E7%89%87/image64.png)

# <center>第五章 地质元数据信息管理</center>
这一章主要介绍软件如何将所有数据进行分类统一可视化。
## 5.1 地质元数据库说明
海量的多源异构数据无法做到一次性读取渲染，必须建立一套灵活的数据模型。软件将所有的地质空间数据分为四个大类：点数据、线数据、面元数据以及体素数据，然后根据数据的分类建立一张数据表``GeoMetaData``用以保存和管理数据。
***
关于数据表``GeoMetaData``的说明如下：

|字段名|类型|说明|备注|
|------|-----|------|-----|
|ID|Long(8)|记录编号||
|Name|VChar(50)|数据名称||
|Type|Char(6)|数据类型||
|DataSuffix|Char(6)|数据类型后缀|保存数据的后缀方便数据还原|
|Abstract|VChar(1000)|数据简介(描述)||
|Longitude1|double|经度1(x1)||
|Longitude2|double|经度2(x2)||
|Latitude1|double|纬度1(y1)||
|Latitude2|double|纬度2(y2)||
|Depth1|double|深度1(z1)|Z坐标系向下|
|Depth2|double|深度2(z2)|Z坐标系向下|
|UserID|VChar(50)|上传用户ID||
|Access|Char(6)|权限|第1-2位，查询权限；第3-4位，显示权限；第4-5位，下载权限|
|Data|binary|二进制保存的数据|数据类型参考Type定义|
|Download|VChar(200)|数据下载连接||
|Url|binary|数据详细描述HTML页面|采用WebView2显示HTML页面或者pdf数据|
***

其中有关数据类型与权限的说明如下:

|字段名|枚举值|说明|
|-----|-----|------|
|**Type**|**010000**|**点数据**|
|Type|010100|坐标标记点|
|Type|010200|地质点|
|Type|010300|钻孔数据|
|Type|010400|地球物理测点|
|Type|010500|化探点|
|Type|010600|文章文献报告等(pdf,word等)|
|Type|01FF00|其他点数据|
|**Type**|**020000**|**线数据**|
|**Type**|**030000**|**面数据**|
|Type|030100|横向平面/曲面（XOY）|
|Type|030101|地质图（位图）|
|Type|030102|地形图（tif网格数据）|
|Type|030103|地形图（grd网格数据）|
|Type|030104|GIS图层(shp)格式|
|Type|0301FF|其他类型（工作区，平面等）|
|Type|030200|纵剖面（或曲面）（垂直于XOY平面）|
|Type|030201|地质/地球物理勘探面（位图格式）|
|Type|030202|地质/地球物理勘探面（数据格式,dat,txt,rar）|
|Type|030203|地质/地球物理勘探面（三维三角网格式，ply格式）|
|Type|030204|地质/地球物理勘探面（三维三角网格式，obj格式）|
|Type|030205|地质/地球物理勘探面（三维三角网格式，stl格式）|
|Type|030206|地质/地球物理勘探面（grd格式）|
|Type|030207|地质/地球物理勘探面（srf格式）|
|Type|0302FF|其他|
|**Type**|**040000**|**三维网格数据**|
|Type|040100|3DGRID格式|
|Type|040200|ASCII格式|
|Type|050000|三维数据格式|
|Type|050100|g3d格式|
|Type|050200|ply格式|
|Type|050300|obj格式|
|Type|050400|stl格式|
|**Access**|**000000**|**查询权限**|
|Access|000000|允许所有用户查询|
|Access|110000|允许所有登录用户查询|
|Access|XX0000|允许指定用户等级查询（用户等级>=XX，11 ~ FF ）|
|**Access**|**000000**|**显示权限**|
|Access|000000|允许所有用户显示|
|**Access**|**000000**|**下载权限**|
|Access|000000|允许所有用户下载|
***
## 5.2 元数据入库
关于地质元数据的数据录入，软件设有统一的数据录入界面，通过``Coordinate``->`Meta Data`即可打开对应界面：

![数据录入](./%E5%9B%BE%E7%89%87/2022-09-23%2016.31.34.png)

数据录入界面分为两个部分，左侧界面栏负责数据的录入，右侧界面栏是数据库中所有数据的预览。
>**备注：**
><br>
>数据的录入界面对应5.1节中``GeoMetaData``表中的所有属性，在进行数据录入的时候，不同类型的数据需要在相应的属性栏输入相应的属性。对于数据的预览功能可以在数据录入后检查数据的准确性。
### 5.2.1 添加地质点数据
在地质元数据录入界面的相应属性栏输入数据内容，将数据类型选为``地质点``，如图:

![点数据](./%E5%9B%BE%E7%89%87/2022-09-23%2016.57.14.png)

点数据除了自身的空间位置一般不包含任何其他信息，所有添加数据文件，相应的数据链接也应该为空。

每一个点数据都可以输入一份解释说明点数据的详细信息文件，信息文件支持.pdf格式。由于是pdf文件数据的详细信息文件可以包含许多额外的信息，甚至可以从word文件导出。以本次输入的数据为例，额外的详细信息可以是:

![额外信息](./%E5%9B%BE%E7%89%87/image18.png)

对于点数据的空间信息，经度1和经度2应该一致，纬度1和纬度2也应该一致，同样地，深度1和深度2也应该一致，只需要输入点数据对应的空间信息即可。其中上传用户ID和权限是可选的数据。保证填入所有对应的数据后，就可以点击``添加``即可将数据保存到元数据库中，并在右侧的预览窗口同步显示，类似于：

![](./%E5%9B%BE%E7%89%87/2022-09-28%2014.45.12.png)

如果某些必填数据没有填入或者输入格式有误，则无法添加点数据到元数据库中，类似于：

![](./%E5%9B%BE%E7%89%87/2022-09-23%2017.16.46.png)

### 5.2.2 添加地质图数据
不同与地质点数据，地质图数据是一种二维数据，元数据信息录入的时候需要注意经纬范围与属性框的内容一一对应。
> 注意：
> - 经度1(x1)对应经纬范围中经度的最小值，经度2(x2)对应经纬范围中经度的最大值;
> - 纬度1(y1)对应经纬范围中纬度的最小值，纬度2(y2)对应经纬范围中纬度的最大值;
> - 地质图一种二维数据，所以地质图的深度1与深度2的值对应着高程值且大小一致。

渲染地质图依据的是给定的经纬范围，所以地质图的经纬范围需要与原图一一对应。然而大部分的地质图原始文件由于存在图例、白边等，依据原图中标定的经纬范围渲染，就会存在坐标偏移的问题。软件提供坐标校正的功能，当加载好地质图的数据文件后，点击旁边的![](./%E5%9B%BE%E7%89%87/2022-09-28%2015.10.43.png)图标就能弹出坐标校正的界面，类似于：

![](./%E5%9B%BE%E7%89%87/2022-09-28%2015.12.46.png)

在本次的例子中，真正的原图是中间的一部分，由于地质图的经纬范围是一个矩形，所以坐标校正界面通过将多余裁剪掉的方式进行坐标校正。通过鼠标左键点击出需要框选出的矩形范围后就会形成一个红色矩形，软件不限制点击的次序，如图：

![](./%E5%9B%BE%E7%89%87/2022-09-28%2015.20.01.png)

如果框选的结果不满意，可以通过鼠标右键点击清除上一次的框选结果。框选完毕后在工具栏点击``裁剪``，可以预览裁剪的结果，如图：

![](./%E5%9B%BE%E7%89%87/2022-09-28%2015.30.09.png)

在某些特殊情况下，如果对框选的结果不满意，可以点击``还原``按钮将图像还原为最初的样子。软件支持多次裁剪得到一个最佳的结果，点击``确定``即可完成地质图的坐标校正。

与地质点数据类似，地质图数据支持添加详细信息文件，添加方式与``5.2.1节``一致，此处不再赘述。

最后点击``添加``就完成了地质图添加的任务。如图：

![](./%E5%9B%BE%E7%89%87/2022-09-28%2015.35.36.png)

### 5.2.3 添加体素数据
体素数据信息录入同样需要注意将数据的空间经纬范围与属性框的内容一一对应。
>注意：
> - 经度1(x1)对应经纬空间范围中经度的最小值，经度2(x2)对应经纬空间范围中经度的最大值;
> - 纬度1(y1)对应经纬空间范围中纬度的最小值，纬度2(y2)对应经纬空间范围中纬度的最大值;
> - 深度1(z1)对应经纬空间范围中高程值最小值，深度2(z2)对应经纬空间范围中高程值最大值。

体素数据同样支持添加详细信息文件，添加文件方式与地质点数据和地质图数据一致，此处不再赘述。

添加完数据文件和数据详细信息文件，最后填入属性框的数据就可以点击``添加``完成体素数据的入库，如图：

![](./%E5%9B%BE%E7%89%87/2022-09-28%2015.49.25.png)

## 5.3 数据信息修改
数据库表中每一个记录项是支持修改的，当数据的信息录入出现错误后是支持修改的。在右边数据表预览窗口，选中需要修改的数据记录项，再点击工具栏的图标![](./%E5%9B%BE%E7%89%87/2022-09-28%2016.51.11.png)，即可将数据的相关信息读取到坐标的数据录入栏中，最后根据需要修改的内容修改数据。如图：

![](./%E5%9B%BE%E7%89%87/2022-09-28%2016.57.20.png)

修改完毕后点击``修改按钮``，数据就会更新到数据库中。

## 5.3 数据信息删除
在数据库中的记录项是支持删除的，删除支持多种方式的删除：单一记录项删除、多个记录项删除和全部记录项删除。
### 5.3.1 单一记录项删除
选中需要删除的记录项，如图：
![](./%E5%9B%BE%E7%89%87/2022-09-28%2017.03.44.png)
再点击工具栏上的![](./%E5%9B%BE%E7%89%87/2022-09-28%2017.04.32.png)按钮即可将选中的记录项删除。
### 5.3.2 多个记录项删除
记录项的多选可以通过键盘的``Ctrl``键和``Shift``键进行多选，多选的逻辑通过文件多选一致。如图：
![](./%E5%9B%BE%E7%89%87/2022-09-28%2017.08.00.png)
再点击工具栏上的![](./%E5%9B%BE%E7%89%87/2022-09-28%2017.04.32.png)按钮即可将选中的记录项删除。
### 5.3.3 全部记录项删除
数据库中的所有数据是支持全部删除的，全部删除可以通过工具栏上的``清除``按钮进行操作。点击后会弹出数据删除确认提示框如图：

![](./%E5%9B%BE%E7%89%87/2022-09-28%2017.11.17.png)

点击``是``即可删除数据库中的所有数据，点击``否``则取消操作。
> **⚠☠⚠特别注意：**
> 
> 数据从数据库删除后，数据无法恢复，需要重新录入。数据无价，请谨慎操作!
## 5.4 数据筛选查询
数据库中的数据记录项变多后，查询数据后变得十分困难，所以软件支持按照数据的类型条件查询，让数据变得更加的明晰。

通过工具栏上的``条件查询``下拉框，如图。

![](./%E5%9B%BE%E7%89%87/2022-09-28%2017.18.47.png)

选中想要选择的数据类型，即可在数据预览窗口选择查询结果，如图：

![](./%E5%9B%BE%E7%89%87/2022-09-28%2017.20.13.png)

还原所有数据预览，可以通过工具栏上的``全部``按钮还原所有数据预览，如图。

![](./%E5%9B%BE%E7%89%87/2022-09-28%2017.21.58.png)

## 5.5 地质元数据管理
数据通过数据录入界面录入后，支持在数字地球上统一管理和显示，可以通过菜单栏的``Coordinate``对应的``GeoResearch Data``，调出信息管理界面。通过数据库选择下拉框选择``地质元数据库``,如图：

![](./%E5%9B%BE%E7%89%87/2022-09-29%2015.26.23.png)

再点击``加载``，即可加载数据库中的所有数据,如图：

![](./%E5%9B%BE%E7%89%87/2022-09-29%2015.31.53.png)

选中数据库中的记录项，再点击底部的``加载``按钮即可将选中的数据加载到数字地球上。如果需要加载所有的数据，可以点击底部左边的``全选``，再点击加载即可。

>注：数据库中记录项可以单选也可以多选，选择的逻辑与``5.3节``的删除选择逻辑一致。
### 5.5.1 地质点数据管理
地质点数据推荐加载多个数据点，加载后可以将数据点按照路线串联起来。选中多个数据点后点击``加载``就会将数据渲染到数字地球上，如图：

![](./%E5%9B%BE%E7%89%87/2022-09-29%2015.43.56.png)

对于点数据软件会做尺度的优化，点数据的比例会根据视点的高度进行缩放，使得在任意视点高度都能观察到坐标点。

注意到，加载点数据后，软件的主界面多了一个``地质元数据图层``管理窗口，这个窗口就是管理加载所有加载好的地质元数据窗口。

**查看详细信息**

右键目标数据所在的节点，即可调出右键菜单，如图:

![](./%E5%9B%BE%E7%89%87/2022-09-29%2015.56.50.png)

点击查看详细信息，即可在右侧的窗口显示之前保存数据时所对应的数据详细信息文件，如图：

![](./%E5%9B%BE%E7%89%87/2022-09-29%2015.58.42.png)

**添加数据**

通过右键菜单点击添加数据，就可再次调出数据添加界面。

**移除数据**

通过右键菜单点击移除数据，即可将目标数据从图层控制界面和数字地球上移除掉。

**数据缩放**

加载到数字地球上的数据支持通过图层控制的节点，动画缩放到合适显示的视点高度，通过双击目标数据的节点即可，缩放后数据还会高亮显示。如图：

![](./%E5%9B%BE%E7%89%87/2022-09-29%2016.11.48.png)

**数据选择**

数据显示到数字地球上后，支持通过鼠标来选择。通过鼠标左键点击数据所在的位置，即可高亮显示选中的数据，并显示对应数据的详细信息，如图：

![](./%E5%9B%BE%E7%89%87/2022-09-29%2016.15.52.png)

**数据可视开关**

通过图层控制窗口中地质点的复选框，可以控制对应数据在数字地球上的显示与否。通过复选框可以确定加载的数据的显示状态。当复选框选中时，说明该数据已经显示在数字地球上，当复选框没有选中时，该数据没有显示在数字地球上，如图：

![](./%E5%9B%BE%E7%89%87/2022-09-29%2016.20.32.png)

### 5.5.2 地质图数据管理

与地质点数据管理的逻辑基本一致，地质图数据可以通过数据添加界面，加载目标地质图数据，如图：

![](./%E5%9B%BE%E7%89%87/2022-09-29%2016.24.42.png)

**查看详细信息**

同样可以通过右键菜单查看目标地质图的详细信息，如图：

![](./%E5%9B%BE%E7%89%87/2022-09-29%2016.26.57.png)

本例中，由于数据没有加载详细信息，所以详细信息窗口为空。

**添加数据**

通过右键菜单点击添加数据，就可再次调出数据添加界面。

**移除数据**

通过右键菜单点击移除数据，即可将目标数据从图层控制界面和数字地球上移除掉。

**数据缩放**

加载到数字地球上的数据支持通过图层控制的节点，动画缩放到合适显示的视点高度，通过双击目标数据的节点即可,如图：

![](./%E5%9B%BE%E7%89%87/2022-09-29%2016.30.08.png)

**数据可视开关**

通过图层控制窗口中地质点的复选框，可以控制对应数据在数字地球上的显示与否。通过复选框可以确定加载的数据的显示状态。当复选框选中时，说明该数据已经显示在数字地球上，当复选框没有选中时，该数据没有显示在数字地球上，如图：

![](./%E5%9B%BE%E7%89%87/2022-09-29%2016.31.32.png)

### 5.5.3 地质体素数据管理

与地质点数据和地质图数据管理的逻辑基本一致，地质体素数据可以通过数据添加界面，加载目标地质体素数据，如图：

![](./%E5%9B%BE%E7%89%87/2022-09-29%2016.36.30.png)

**数据缩放**

加载到数字地球上的数据支持通过图层控制的节点，动画缩放到合适显示的视点高度，通过双击目标数据的节点即可，如图：

![](./%E5%9B%BE%E7%89%87/2022-09-29%2016.38.04.png)

**添加数据**

通过右键菜单点击添加数据，就可再次调出数据添加界面。

**移除数据**

通过右键菜单点击移除数据，即可将目标数据从图层控制界面和数字地球上移除掉。

**数据可视开关**

通过图层控制窗口中地质点的复选框，可以控制对应数据在数字地球上的显示与否。通过复选框可以确定加载的数据的显示状态。当复选框选中时，说明该数据已经显示在数字地球上，当复选框没有选中时，该数据没有显示在数字地球上。

## 5.6 元数据属性修改
根据前文3.4节所述，软件支持对渲染到窗口的对象修改其相关属性，这同样适用于地质元数据。软件支持修改的属性见3.4节。本节以修改地质元数据透明度为例介绍地质元数据的属性修改方法。

**元数据透明度修改**
以渲染到窗口中的地质图数据为例，如图：

![](./%E5%9B%BE%E7%89%87/2022-10-04%2019.26.09.png)

点击主窗口左侧的``Objects``窗口组件，切换到对象窗口，如图：

![](./%E5%9B%BE%E7%89%87/2022-10-04%2019.27.56.png)

``Objects``窗口指示了目前渲染窗口中渲染的所有对象，由于在不同层级下软件采用不同的图层加载方式，所以在对象窗口可能有地质图对象的多个不同副本，可以通过对象前面的复选框确定当前可见的地质图像对象。点击对象的所在的节点即可出现对象的属性修改窗口，如图：

![](./%E5%9B%BE%E7%89%87/2022-10-04%2019.32.43.png)

可以将选中的对象相关的属性设置为想要的数值，例如修改Blend栏中的``Alpha``值对应修改对象的透明度，对象的透明度将被限制在0到1之间，0对应完全不透明，1对应完全透明。将对象的透明度修改为0.5的效果如图所示:
![](./%E5%9B%BE%E7%89%87/2022-10-04%2019.39.24.png)

# <center> 第五章 高级设置</center>
本章主要介绍DEIMS的有关的高级设置功能，包括网络瓦片元选择设置、地形瓦片源选择设置和软件缓存路径设置等。
## 5.1 添加网络瓦片源

软件支持多达十数种网络瓦片源切换选择，软件支持瓦片源地址在``Coordinate``的``Setting``调出设置界面找到，如图：

![](./%E5%9B%BE%E7%89%87/2022-10-10%2021.49.41.png)

当前加载的图源会以按钮会以红色的背景高亮显示，同时每一个支持的图源也会显示相应的预览图。通过鼠标左键点击可以切换想要的图源，添加成功后会提示添加成功的提示框，如图：

![](./%E5%9B%BE%E7%89%87/2022-10-10%2021.59.47.png)

同样的添加后的图源后以红色背景高亮显示，如图：

![](./%E5%9B%BE%E7%89%87/2022-10-10%2022.01.23.png)

## 5.2 切换初始网络瓦片源

DEIMS支持切换显示的初始瓦片图源，对于想要切换到的初始图源右键点击对应的图标，则会出现切换为**初始图源**的提示，如图：

![](./%E5%9B%BE%E7%89%87/2022-10-11%2020.54.19.png)

再点击``设为初始图源``，即可将对应的图源设为初始的网络瓦片源，并出现切换成功的提示：

![](./%E5%9B%BE%E7%89%87/2022-10-11%2020.56.10.png)

点击``是``就是重启软件，并切换到对应的初始网络瓦片源，点击``否``或者``取消``就会在下一次打开软件时生效。

## 5.3 添加自定义瓦片源初始化

软件支持通过修改软件配置文件来添加自定义配置文件，通过在软件的安装目录找到``.Config``文件，以记事本的形式打开，如图：

![](./%E5%9B%BE%E7%89%87/2022-10-11%2021.00.25.png)

![](./%E5%9B%BE%E7%89%87/2022-10-11%2021.02.30.png)

根据提示修改``tileSource``的内容，即可成功修改瓦片源。

**注:**

支持两种不同的图源初始化:

    1.有图源地址:name,url添入相应的信息；
    2.支持一些自带的图源,
    name只能在下面选择:
    BingAerial,BingAerialStaging,BingHybrid,BingHybridStaging,BingRoads,BingRoadsStaging,BKGTopPlusColor,
    BKGTopPlusGrey,EsriWorldBoundariesAndPlaces,EsriWorldDarkGrayBase,EsriWorldPhysical,EsriWorldReferenceOverlay,
    EsriWorldShadedRelief,EsriWorldTransportation,EsriWorldTopo,OpenCycleMap,OpenCycleMapTransport,OpenStreetMap,
    StamenToner,StamenTonerLite,StamenWatercolor
    url="Local"
    注意网址中的&需要转义为&amp;

## 5.4 地形开关

DEIMS支持修改地形的开启与关闭状态，在``Setting``界面找到地形开关选项，通过数据鼠标左键可以改变地形开关的开启状态，如图：

![](./%E5%9B%BE%E7%89%87/2022-10-11%2021.08.40.png)

注意：地形开关的开启与关闭是实时改变的。

## 5.5 地形瓦片源选择

DEIMS目前只支持一种地形瓦片源:Map box Source。所以暂时不支持修改地形瓦片源的修改，尽情期待后续更新。如图。

![](./%E5%9B%BE%E7%89%87/2022-10-11%2021.11.33.png)

## 5.6 软件缓存文件夹修改

软件为了提高运行效率，支持网络瓦片的离线缓存，所以需要设置一个缓存文件夹。除此之外，还包含一些其它的文件缓存都需要存放在这个文件夹。如果修改移动这个缓存文件夹，则需要在``Setting``界面修改软件缓存文件夹，如图：

![](./%E5%9B%BE%E7%89%87/2022-10-11%2021.15.07.png)

点击``浏览``即可在弹出的文件夹选择框中选择目标文件夹路径，最后点击``确定``即可修改软件的缓存文件路径。
>注：
>请不要频繁的变动软件的缓存文件夹路径，因为每一次的变更导致影像数据会重新下载，进而降低软件的运行速度。

# <center>第六章 软件的开发难点</center>

## 6.1 渲染技术开发

软件中凡是涉及到三维图形的可视化都避免不了与底层的渲染接口打交道，这样才能渲染出想要的三维效果。目前的主流的图形应用程序接口有OpenGL、DirectX和Vulkan。软件的底层技术驱动的是最新一代应用图形渲染接口Vulkan。Vulkan是一个跨平台的2D和3D绘图应用程序接口，最早由科纳斯组织在2015年的游戏开发者大会上发布，以更低的开销渲染出更好的图形效果，是下一代的图形渲染技术。拥有更快的性能、更低的开销、更少的延迟，可移植和可扩展的渲染优势，能够更好的适应软件的渲染需求。Vulkan虽相较于其他图形API具有十分强大的渲染性能，但是获得这些优势的代价是开发者必须处理十分冗长的API。在软件的程序中，每一个跟三维图形渲染的细节都需要从头开始编写，包括帧缓冲器的创建和对象的内存管理，使得软件的开发的难度指数型上升。不过这一切都是值得的，软件拥有全自主开发的底层Vulkan驱动库， 相较于其他图形API软件使用Vulkan开发平均渲染性能提升达30%，带来了更好的图形效果和交互体验。

## 6.2 多源异构数据的整合

软件显示的数据信息主要来源于野外的原始地质调查数据，这些数据的数据格式不尽相同。不同的路线整合的原始资料也不同，如何将原始的数据经过数据层的抽象后再可视化出来是本软件开发的一大难点。通过对原始资料的解构分析发现，资料主要由.doc、.docx、.xls和.xlsx几种格式组成，虽然一条路线中包含有许多额外的信息。但分析总结路线信息的主要由以下几个部分组成：1.一条路线下包含有许多不同的地质点号;2.每个地质点号都包含有几个相同的大类信息，例如点间路线，点上样品，点上照片等。所以经过数据层的抽象后，最终将这些数据在数据库建表存储规范化，以便后续的可视化读取。数据库中表的结构如图所示： 

![](./%E5%9B%BE%E7%89%87/%E5%9B%BE%E7%89%871.png)

同时作为一款专业的地质可视化软件，数据库数据的入库操作必然是自动化的。为了实现对数据到数据库的一系列操作的自动化执行，软件使用了OpenXML技术，直接读取原有的文档后识别并规范化的存储到数据库中。

## 6.3 大规模影像数据渲染

软件使用了三维数字地球作为地质调查数据的可视化管理的基础，而渲染出一个真实的三维数字地球确不是一件容易的事情。三维数字地球的渲染主要存在以下三大难点：

1.三维数字地球的结构模拟算法。要想在渲染窗口中，渲染出真实的三维实体是需要经过许多步骤的。首当其冲的就是对三维实体框架的点的求解，因为在计算机图形学中，渲染到屏幕上的三维实体是由一个个的三角形组成。要想渲染出要想的三维实体就必须计算出三维实体的每个顶点坐标。软件对地球的模拟采用的是表面细分技术，来计算出球面上对应的顶点坐标和纹理坐标，来达到对现实的三维地球形态的模拟。

2.大规模贴图数据渲染优化算法。对于一个真实的三维数字地球的球体，如何将对应清晰度的影像数据贴在正确的位置，是整个渲染过程最为核心以及最为困难的。最基本的思路就是在视角较高的时候渲染低清晰度的影像数据，在视角较低的时候渲染高清晰度的影像数据。这样就对影像数据的存储，渲染次序都有着非常高的要求。对于这个问题软件采用的是对于每个层级的影像数据，先经过四叉树算法或者定尺寸算法裁剪后存放到数据库中，渲染时在调用对应范围的影像数据，有效的避免了一次性渲染大量的数据导致程序卡死的情况出现。这种思想也就是图像金字塔技术。

3.屏幕点到三维实体的坐标互相映射。不管是三维数字地球的贴图还是原始的地质调查数据，所用的空间信息都是经纬度和高程格式。如何将其转换为笛卡尔坐标后再转换为屏幕空间坐标，是三维实体渲染到屏幕上必须解决的问题；如果将屏幕空间坐标转换为数据空间中的坐标，是从屏幕上选择渲染的三维实体必须解决的问题。软件通过一系列的矩阵的坐标转换算法，最终实现了渲染和点选的难题，进一步的拓展了软件的实用性。

# <ceter> 第七章 软件应用前景</center>

数字班公怒江地质信息管理系统以班-怒带铬铁矿与铂族元素成矿潜力子专题任务为依托，开发的一款专业的三维可视化数据管理软件。传统的野外地质工作采集的数据普遍以二维显示和分析的主导地位，本软件的开发将数据的归档管理提升了一个维度，维度的提升将使得地质分析更加的清晰直观。并且结合传统的地质分析，更高的维度将也会带来全新的视野，让地质工作者从复杂而无序的数据中解放出来，更容易和快速的从原始的数据提炼出重要的科学成果。
本软件的开发和应用将给地质工作者带来巨大的效率提升和高效的数据管理方式，在野外区域地质调查、地质填图、矿产预测与开发等方面都可以得到重要的应用。同时随着软件后续功能的不断完善，例如：数据的组合预测，三维地形叠加分析，成矿潜力评价等等，都可以利用原始数据推测出的信息并直接建模可视化，软件的应用前景不可估量。


